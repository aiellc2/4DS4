// Copyright by Adam Kinsman, Henry Ko and Nicola Nicolici
// Developed for the Embedded Systems course (COE4DS4)
// Department of Electrical and Computer Engineering
// McMaster University
// Ontario, Canada

#include "define.h"

static int sw_buf;
static int floor_request;
void SW_interrupt(void) {


	//if (sw_buf != (IORD(SWITCH_I_BASE, 0)& 0x3FFF ))

	alt_printf("Switches changed\n");

    floor_request = (floor_request | (IORD(SWITCH_I_BASE, 0)& 0x3FFF ));

    IOWR(LED_RED_O_BASE, 0, floor_request);
    IOWR(SWITCH_I_BASE, 3, 0x0);

    //sw_buf = (IORD(SWITCH_I_BASE, 0)& 0x3FFF );

}

int main()
{

	sw_buf = 0;
	printf("Start main...\n");

	init_button_irq();
	printf("PB initialized...\n");

	init_counter_irq();
	printf("Counter IRQ initialized...\n");

	init_counter_irq2();
	printf("Counter 2 IRQ initialized...\n");

	IOWR(LED_GREEN_O_BASE, 0, 0x0);
	IOWR(LED_RED_O_BASE, 0, 0x0);

	IOWR(SWITCH_I_BASE, 3, 0x0); // edge capture register
	IOWR(SWITCH_I_BASE, 2, 0x3FFF); // IRQ mask
	alt_irq_register(SWITCH_I_IRQ, NULL, (void*)SW_interrupt);

	printf("Switch value: %X\n", IORD(SWITCH_I_BASE, 0));

	while (1){



	}

	return 0;
}
